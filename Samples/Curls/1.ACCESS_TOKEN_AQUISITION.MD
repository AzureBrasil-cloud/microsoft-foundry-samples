# Como obter um Access Token (Azure) usando Client Credentials (Client ID + Client Secret)

Guia rápido para gerar um Access Token do Azure AD (Microsoft Entra ID) com Client Credentials (Service Principal) usando variáveis de ambiente. Use esse token para chamar recursos Azure (ex.: Azure OpenAI, Key Vault, Storage, ARM).

 
---
 
## Pré-requisitos
- App Registration (Service Principal) no Microsoft Entra ID.
- Client Secret criado para o App Registration.
- Permissões no recurso:
  - RBAC (recomendado) — role atribuída no recurso.
  - ou permissões de API (quando aplicável).

Observação: o "scope" (resource) depende do serviço. Para ARM use `https://management.azure.com/.default`. Para outros serviços, use o scope específico (ex.: `https://ai.azure.com/.default`, `https://vault.azure.net/.default`, `https://storage.azure.com/.default`).

---
 
## 1) Defina variáveis de ambiente

macOS / Linux (bash/zsh):
```bash
export AZURE_TENANT_ID="xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"
export AZURE_CLIENT_ID="xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"
export AZURE_CLIENT_SECRET="seu-client-secret-aqui"
export AZURE_SCOPE="https://ai.azure.com/.default"
```

Windows PowerShell:
```powershell
$Env:AZURE_TENANT_ID="xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"
$Env:AZURE_CLIENT_ID="xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"
$Env:AZURE_CLIENT_SECRET="seu-client-secret-aqui"
$Env:AZURE_SCOPE="https://ai.azure.com/.default"
```
## 2) Solicite o token (cURL)

```bash
curl -s -X POST "https://login.microsoftonline.com/${AZURE_TENANT_ID}/oauth2/v2.0/token" \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "client_id=${AZURE_CLIENT_ID}" \
  -d "client_secret=${AZURE_CLIENT_SECRET}" \
  -d "scope=${AZURE_SCOPE}" \
  -d "grant_type=client_credentials"
```

Para extrair só o token (requer `jq`):
```bash
curl -s ... | jq -r .access_token
```

Resposta típica:
```json
{
  "token_type": "Bearer",
  "expires_in": 3599,
  "ext_expires_in": 3599,
  "access_token": "<seu_access_token>"
}
```

---

## 3) Usar o token
Inclua no header Authorization:
```
Authorization: Bearer <seu_access_token>
```

Exemplo com cURL:
```bash
curl -H "Authorization: Bearer $ACCESS_TOKEN" https://seu-recurso.azure.net/endpoint
```

---

## Boas práticas e dicas
- Não exponha secrets em código ou logs; use Key Vault ou mecanismos de secret management.
- Use SDKs oficiais (Azure SDKs) em produção quando possível.
- Se receber erros:
  - invalid_client → credenciais inválidas.
  - invalid_scope → scope/resource incorreto.
  - unauthorized_client → falta de permissões/role.

---