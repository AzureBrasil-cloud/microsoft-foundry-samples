# Como obter um Access Token (Azure) usando Client ID + Client Secret via variáveis de ambiente
 
Este guia mostra como gerar um **Access Token do Azure AD (Microsoft Entra ID)** para chamar um **recurso em nuvem no Azure** (ex.: Azure OpenAI, Key Vault, Storage, ARM, etc.) usando **Client Credentials** (Service Principal): **Client ID + Client Secret**, com os valores fornecidos por **variáveis de ambiente**.
 
---
 
## Pré-requisitos
 
- Um **App Registration / Service Principal** no Microsoft Entra ID
- Um **Client Secret** criado para esse App Registration
- Permissões atribuídas ao recurso:
  - **RBAC (recomendado)**: atribuição de role no recurso (ex.: *Cognitive Services User*, *Storage Blob Data Reader*, etc.)
  - ou **Permissões em API** (quando aplicável), conforme o serviço
 
> Observação: o “escopo” (scope) do token depende do serviço. O padrão para Azure Resource Manager é `https://management.azure.com/.default`. Para outros serviços, o resource/scope muda.
 
---
 
## 1) Defina as variáveis de ambiente
 
### macOS / Linux (bash/zsh)
 
```bash
export AZURE_TENANT_ID="xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"
export AZURE_CLIENT_ID="xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"
export AZURE_CLIENT_SECRET="seu-client-secret-aqui"
 
# Escopo do recurso (exemplos)
#export AZURE_SCOPE="https://management.azure.com/.default"
export AZURE_SCOPE="https://ai.azure.com/.default"
# export AZURE_SCOPE="https://vault.azure.net/.default"
# export AZURE_SCOPE="https://storage.azure.com/.default"
```

```bash
curl -X POST "https://login.microsoftonline.com/${AZURE_TENANT_ID}/oauth2/v2.0/token" \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "client_id=${AZURE_CLIENT_ID}" \
  -d "client_secret=${AZURE_CLIENT_SECRET}" \
  -d "scope=${AZURE_SCOPE}" \
  -d "grant_type=client_credentials"
````

O retorno vai ser um objeto do tipo:

```json
{
  "token_type": null,
  "expires_in": null,
  "ext_expires_in": null,
  "access_token": "<seu_acess_token>"
}

```

Utiliza esse ```access_token``` para consumir os outros endpoints.